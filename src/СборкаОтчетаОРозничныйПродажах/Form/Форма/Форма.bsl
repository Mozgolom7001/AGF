
&НаКлиенте
Процедура ПолучитьПоЧекам(Команда)
	ПолучитьПоЧекамНаСервере();
КонецПроцедуры

&НаСервере
Процедура ПолучитьПоЧекамНаСервере()
	
	ЗаполнитьТовары();
	ЗаполнитьОплатыПлатежнымиКартами();
КонецПроцедуры

// <Описание процедуры>
//
&НаСервере
Процедура ЗаполнитьОплатыПлатежнымиКартами()

		//{{КОНСТРУКТОР_ЗАПРОСА_С_ОБРАБОТКОЙ_РЕЗУЛЬТАТА
	// Данный фрагмент построен конструктором.
	// При повторном использовании конструктора, внесенные вручную изменения будут утеряны!!!
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
		"ВЫБРАТЬ
		|	ЧекККМОплата.ВидОплаты КАК ВидОплаты,
		|	ЧекККМОплата.Сумма КАК Сумма,
		|	ЧекККМОплата.ПроцентКомиссии КАК ПроцентКомиссии,
		|	ЧекККМОплата.СуммаКомиссии КАК СуммаКомиссии,
		|	ЧекККМОплата.ЭквайринговыйТерминал КАК ЭквайринговыйТерминал,
		|	ЧекККМОплата.ДоговорПлатежногоАгента КАК ДоговорПлатежногоАгента
		|ИЗ
		|	Документ.ЧекККМ.Оплата КАК ЧекККМОплата
		|ГДЕ
		|	ЧекККМОплата.Ссылка.Дата МЕЖДУ &ДатаНачала И &ДатаОкончания
		|	И ЧекККМОплата.ВидОплаты = &ВидОплаты";
	
	Запрос.УстановитьПараметр("ВидОплаты", Объект.ВидБезналичнойОплаты);
	Запрос.УстановитьПараметр("ДатаНачала",НачалоДня(Объект.ДатаСбораЧековККМ));
	Запрос.УстановитьПараметр("ДатаОкончания", КонецДня(Объект.ДатаСбораЧековККМ));
	
	РезультатЗапроса = Запрос.Выполнить();
	
	ТЗ_Оплаты = РезультатЗапроса.Выгрузить();
	
	Объект.ОплатаПлатежнымиКартами.Загрузить(ТЗ_Оплаты);
	
	//}}КОНСТРУКТОР_ЗАПРОСА_С_ОБРАБОТКОЙ_РЕЗУЛЬТАТА
	

КонецПроцедуры // ЗаполнитьОплатыПлатежнымиКартами()
 
// <Описание процедуры>
//
&НаСервере
Процедура ЗаполнитьТовары()

		//{{КОНСТРУКТОР_ЗАПРОСА_С_ОБРАБОТКОЙ_РЕЗУЛЬТАТА
	// Данный фрагмент построен конструктором.
	// При повторном использовании конструктора, внесенные вручную изменения будут утеряны!!!
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
		"ВЫБРАТЬ
		|	ЧекККМТовары.Номенклатура КАК Номенклатура,
		|	ЧекККМТовары.Характеристика КАК Характеристика,
		|	ЧекККМТовары.Количество КАК Количество,
		|	ЧекККМТовары.Цена КАК Цена,
		|	ЧекККМТовары.Сумма КАК Сумма,
		|	ЧекККМТовары.СтавкаНДС КАК СтавкаНДС,
		|	ЧекККМТовары.СуммаНДС КАК СуммаНДС,
		|	ЧекККМТовары.РегистрацияПродажи КАК РегистрацияПродажи,
		|	ЧекККМТовары.Склад КАК Склад,
		|	ЧекККМТовары.КлючСвязиСерийныхНомеров КАК КлючСвязиСерийныхНомеров,
		|	ЧекККМТовары.КодСтроки КАК КодСтроки,
		|	ЧекККМТовары.ЗаказПокупателя КАК ЗаказПокупателя,
		|	ЧекККМТовары.Резервировать КАК Резервировать
		|ИЗ
		|	Документ.ЧекККМ.Товары КАК ЧекККМТовары
		|ГДЕ
		|	ЧекККМТовары.Ссылка.Дата МЕЖДУ &ДатаНачала И &ДатаОкончания";
	
	Запрос.УстановитьПараметр("ДатаНачала", НачалоДня(Объект.ДатаСбораЧековККМ));
	Запрос.УстановитьПараметр("ДатаОкончания", КонецДня(Объект.ДатаСбораЧековККМ));
	
	РезультатЗапроса = Запрос.Выполнить();
	
	ТЗ_Товары = РезультатЗапроса.Выгрузить();
	
	Объект.Товары.Загрузить(ТЗ_Товары);
	
	//}}КОНСТРУКТОР_ЗАПРОСА_С_ОБРАБОТКОЙ_РЕЗУЛЬТАТА


КонецПроцедуры // ЗаполнитьТовары()
 